---
title: 类加载机制的深度解析
date: 2022-08-24 00:20:48
tags: 类加载机制
categories: 性能调优
---

## 类加载运行全过程

当我们用java命令运行某个类的main函数启动程序时，首先需要通过**类加载器**把主类加载到 JVM。

有如下几步： **加载 >> 验证 >> 准备 >> 解析 >> 初始化 >>** 使用 >> 卸载 

- 加载：在硬盘上查找并通过IO读入字节码文件，使用到类时才会加载，例如调用类的main()方法，new对象等等，在加载阶段会在内存中生成一个**代表这个类的** **.Class对象**，作为这个类的各种数据的访问入口 。
- 验证：校验字节码文件的正确性 
- 准备：给类的静态变量分配内存，并赋予默认值 
- 解析：将**符号引用**替换为直接引用（地址引用）
- **初始化**：对类的静态变量初始化为指定的值，执行静态代码块



## **类加载器**

- bootstrap ClassLoader引导类加载器：负责加载支撑JVM运行的位于JRE的lib目录下的核心类库，比如 rt.jar、charsets.jar等 
- ExtClassLoader 扩展类加载器：负责加载支撑JVM运行的位于JRE的lib目录下的ext扩展目录中的JAR 类包
- AppClassLoader 应用程序类加载器：负责加载ClassPath路径下的类包，主要就是加载你自己写的那些类
- 自定义加载器：负责加载用户自定义路径下的类包



## **双亲委派机制** 

加载某个类时会先委托父加载器寻找目标类，找不到再委托上层父加载器加载，如果所有父加载器在自己的加载类路径下都找不到目标类，则在自己的类加载路径中查找并载入目标类
