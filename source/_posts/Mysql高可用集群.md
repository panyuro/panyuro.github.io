---
title: Mysql高可用集群
date: 2022-09-21 16:46:09
tags:
categories: mysql
---

# 1 Mysql主从同步(复制)原理

数据库的主从同步，就是为了要保证多个数据库之间的数据保持一致。

- 最简单的方式就是使用数据库的导入导出工具，定时将主库的数据导出，再导入到从库当中。这是一种很常见，也很简单易行的数据库集群方式。但是这种方式进行数据同步的实时性比较差。

- 如果要保证数据能够实时同步，对于MySQL，通常就要用到他自身提供的一套通过Binlog日志在多个MySQL服务之间进行同步的集群方案。

## 1.1 **主从复制流程详解：**

- 主库上打开Binlog日志，记录对数据的每一步操作，在主库写入Binlog日志时，也往从库异步传输一份
- 从库为了保证日志接收的稳定性，并不会立即重演Binlog数据操作，而是先将接收到的Binlog日志写入到自己的RelayLog日志当中
- 从库检测到RelayLog中的操作日志有更新，就会在自己数据库中进行异步重演。

> MySQL的BinLog日志能够比较实时的记录主库上的所有日志操作，因此他也被很多其他工具用来实时监控MySQL的数据变化。如：
>
> - 转发到Redis实现缓存一致
> - ClickHouse也支持将自己模拟成一个MySQL的从节点，接收MySQL的Binlog日志，实时同步MySQL的数据。这个功能目前还在实验阶段。

<img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6ebqmc9chj20ua0kmq4t.jpg" style="zoom: 50%;" />

## 1.2 主从复制的策略

1. **「同步策略」**：Master会等待所有的Slave都回应后才会提交，这个主从的同步的性能会严重的影响。
2. **「半同步策略」**：Master至少会等待一个Slave回应并写入relay log后提交。
3. **「异步策略」**：Master不用等待Slave回应就可以提交。

# Mysql的集群结构

- 一主一从
- **为了进一步提高整个集群的读能力，可以扩展出一主多从**。
- **为了提高这个集群的写能力，可以搭建互主集群**，即两个服务互为主从。这样不管写到哪个服务上，集群内的数据都是同步的。这样就可以用一个集群来分担写数据的压力
- **可以扩展出多主多从的集群，全方位提升集群的数据读写能力**。甚至，我们也可以扩展出环形的主从集群，实现MySQL多活部署
